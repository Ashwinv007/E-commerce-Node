<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/style.css">
    <title>Dkart - OTP Verification</title>
</head>
<body>
    <div class="homepage">
        <div class="otp-verification-container">
            <div class="otp-icon-wrapper">
                <i class="fas fa-envelope"></i>
            </div>
            
            <div class="otp-verification-header">
                <h1>Check your email</h1>
                <p>We sent a verification code to<br><span class="user-email">{{#if userData}}{{userData.email}}{{else}}your email{{/if}}</span></p>
            </div>

            <form id="otpVerificationForm" action="/verifyOtp" method="post">
                <div class="otp-code-inputs">
                    <input type="number" class="otp-code-input" maxlength="1" id="otpDigit1" name="otp1" required>
                    <input type="number" class="otp-code-input" maxlength="1" id="otpDigit2" name="otp2" required>
                    <input type="number" class="otp-code-input" maxlength="1" id="otpDigit3" name="otp3" required>
                    <input type="number" class="otp-code-input" maxlength="1" id="otpDigit4" name="otp4" required>
                    <input type="number" class="otp-code-input" maxlength="1" id="otpDigit5" name="otp5" required>
                    <input type="number" class="otp-code-input" maxlength="1" id="otpDigit6" name="otp6" required>
                    <input type="hidden" name="otp" id="otp">
                </div>

                <button type="submit" class="otp-verify-btn">Verify email</button>
            </form>

            <div class="otp-resend-section">
                Didn't receive the email? <a href="#" onclick="resendOtp(); return false;">Click to resend</a>
            </div>

            <a href="/login" class="otp-back-to-login">
                <i class="fas fa-arrow-left"></i>
                <span>Back to log in</span>
            </a>
        </div>
    </div>
    <script>
        const otpCodeInputs = document.querySelectorAll('.otp-code-input');
        const otpInput = document.getElementById('otp');

        otpCodeInputs.forEach((input, index) => {
            input.addEventListener('input', function(e) {
                if (this.value.length > 1) {
                    this.value = this.value.slice(0, 1);
                }
                
                if (this.value.length === 1 && index < otpCodeInputs.length - 1) {
                    otpCodeInputs[index + 1].focus();
                }
                updateOtpValue();
            });

            input.addEventListener('keydown', function(e) {
                if (e.key === 'Backspace' && this.value === '' && index > 0) {
                    otpCodeInputs[index - 1].focus();
                }
            });

            input.addEventListener('paste', function(e) {
                e.preventDefault();
                const pasteData = e.clipboardData.getData('text').slice(0, 6);
                const digits = pasteData.split('');
                
                digits.forEach((digit, i) => {
                    if (i < otpCodeInputs.length && /[0-9]/.test(digit)) {
                        otpCodeInputs[i].value = digit;
                    }
                });
                
                if (digits.length < otpCodeInputs.length) {
                    otpCodeInputs[digits.length].focus();
                } else {
                    otpCodeInputs[otpCodeInputs.length - 1].focus();
                }
                updateOtpValue();
            });
        });
        
        function updateOtpValue(){
            let otpValue = '';
            otpCodeInputs.forEach(input => {
                otpValue += input.value;
            });
            otpInput.value = otpValue;
        }

        document.getElementById('otpVerificationForm').addEventListener('submit', function(e) {
            updateOtpValue();
        });

        function resendOtp() {
            fetch('/resendOtp', {method: 'POST'})
                .then(response => response.json())
                .then(data => {
                    alert('A new OTP has been sent to your email.');
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Could not resend OTP. Please try again later.');
                });
        }
    </script>
</body>
</html>