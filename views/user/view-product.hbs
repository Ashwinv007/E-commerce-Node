
<section>
    <div class="container mt-5">
    <div class="row">
      {{#if product}}
        <div class="col-md-3 p-3" >
            <div class="card" style="width: 15rem; height:24rem;">
  {{!-- <img class="card-img-top" src="/product-images//{{this.product._id}}.{{this.imgExt}}" alt="Card image cap" style="height:12rem;"> --}}
                                    <td><img style="width: 100%; height:auto" src="{{product.imageUrls.[0]}}" alt="{{product.productName}}"  onload="checkStock()"></td>

  <div class="card-body">
    <h5 class="card-title">{{product.productName}}</h5>
    <p class="card-text">Rs:{{product.productPrice}}/-</p>
    {{!-- <p class="card-text">Quantity:{{product.quantity}}/-</p> --}}
    {{!-- {{checkStock product.stockAmount}} --}}
    <div id="stockAvailability" name="stockAvailability" >
        <input type="number" id="stockAmount" name="stockAmount" style="display:none" value="{{product.stockAmount}}">
        <h2 id="runningOutOfStock" style="display: none; color:red">Running out of Stock!</h2>
        <h2 id="outOfStock" style="display:none; color:red">Out of Stock</h2>
         </div>
    <p class="card-text">{{product.productDescription}}/-</p>

                                    <button id="cartButton" class="btn btn-primary" onclick="addToCart('{{product._id}}')">Add to Cart</button>

  </div>
</div>
        </div>

        {{/if}}

    </div>
    </div>

        {{!-- <div class="displayRating">
            
 <div class="ratingContainer">
        <div class=" five"></div>
                <div class=" four"></div>

        <div class=" three"></div>

        <div class=" two"></div>

        <div class=" one"></div>

    </div>
        </div> --}}
  <div class="rating-summary">
    <h2>{{response.average}}</h2>
    <p>{{response.totalReviews}} ratings</p>

    {{#each response.starRows}}
    <div class="rating-row">
        <span class="label">{{star}} star</span>
        <div class="bar">
            <div class="fill" style="width: {{percentage}}%;"></div>
        </div>
        <span class="count">{{count}}</span>
    </div>
    {{/each}}
</div>

      
{{#if hasOrdered}}
    {{#if userReview}}
        <div class="reviews">
            <h3>Your Review</h3>
            <div class="ratings">
                <div class="stars" data-rating="{{userReview.ratingValue}}">
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
            <div class="review">
                <p>{{userReview.userReview}}</p>
            </div>
        </div>
    {{else}}
        <form action="/submit-review" method="post">
            <div class="reviewBox">
                <div class="ratingDiv">
                  
        <ul class="rating">
        <li class="rating-item" data-rate="1"></li>
        <li class="rating-item" data-rate="2"></li>
        <li class="rating-item" data-rate="3"></li>
        <li class="rating-item" data-rate="4"></li>
        <li class="rating-item" data-rate="5"></li>
        </ul>
        <input type="number" name="ratingValue" id="ratingValue">
        <input type="text" name="productId" value="{{product._id}}">
        <input type="text" name="userId" value="{{user._id}}">

                </div>
                <div class="review">
                    <input style="height:100px" type="textarea" id="userReview" name="userReview" placeholder="Enter Your Review">
                </div>
                <button type="submit" style="background-color: green;">Submit Review</button>
            </div>
        </form>
    {{/if}}
{{/if}}

{{#each reviews}}
    <div class="reviews">
        <div class="ratings">
{{!--           
<ul class="rating">
<li class="rating-item" data-rate="1"></li>
<li class="rating-item" data-rate="2"></li>
<li class="rating-item" data-rate="3"></li>
<li class="rating-item" data-rate="4"></li>
<li class="rating-item" data-rate="5"></li>
</ul> --}}
<div class="stars" data-rating="{{ratingValue}}">
    <span></span>
    <span></span>
    <span></span>
    <span></span>
    <span></span>
</div>
{{!-- <input type="number" name="ratingValue" id="ratingValue">
<input type="text" name="productId" value="{{product._id}}">
<input type="text" name="userId" value="{{user._id}}"> --}}

        </div>
        <div class="review">
<p>
{{this.userReview}}
</p>        </div>
        {{!-- <button type="submit" style="background-color: green;">Submit Review</button> --}}
    </div>
    {{/each}}
</section>

<script>
    const container = document.querySelector('.rating');
const items = container.querySelectorAll('.rating-item')
container.onclick = e => {
const elClass = e.target.classList;
// change the rating if the user clicks on a different star
if (!elClass.contains('active')) {
items.forEach( // reset the active class on the star
item => item.classList.remove('active')
);
elClass.add('active'); // add active class to the clicked star
}
let ratingValue=document.getElementById("ratingValue")
ratingValue.value=e.target.getAttribute("data-rate")
console.log(e.target.getAttribute("data-rate"));

};
    function checkStock(){
            let stockAmount=document.getElementById("stockAmount").value

        console.log('hi qun:',stockAmount)
        if(stockAmount<=10 && stockAmount!=0){
            document.getElementById("runningOutOfStock").style.display="block"
        }else if(stockAmount==0){
            document.getElementById("outOfStock").style.display="block"
            document.getElementById("cartButton").disabled=true
        }
    }
</script>