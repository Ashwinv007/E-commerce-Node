<section id="ordersList" class="orders-section">
    <div class="page-container">
        <div class="page-header">
            <h1>Your Orders</h1>
            <p>View your past and current orders</p>
        </div>
        <div class="orders-container">
            <table class="orders-table">
                <thead>
                    <tr>    
                        <th scope="col">Image</th>
                        <th scope="col">Date</th>
                        <th scope="col">Address</th>
                        <th scope="col">Pincode</th>
                        <th scope="col">Mobile</th>
                        <th scope="col">Amount</th>
                        <th scope="col">Payment</th>
                        <th scope="col">Status</th>
                        <th scope="col" colspan="3">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each orders}}
                    <tr>
                        <td><img class="order-product-image" src="{{this.productDetails.thumbnailUrl}}" alt=""></td>
                        <td>{{getStringDate this.date}}</td>
                        <td>{{this.deliveryDetails.address}}</td>
                        <td>{{this.deliveryDetails.pincode}}</td>
                        <td>{{this.deliveryDetails.mobile}}</td>
                        <td>â‚¹{{this.totalAmount}}</td>
                        <td>{{this.paymentMethod}}</td>
                        <td><span class="status-badge status-{{this.status}}">{{this.status}}</span></td>
                        <td><a href="/view-product/{{this.productDetails._id}}" class="action-btn view">View Products</a></td>
                        {{#if this.userAction}}
                            <td><a href="/track-order-delivery/{{this._id}}" class="action-btn track">Track Order</a></td>
                            <td><button onclick="cancelOrderedProducts('{{this._id}}')" class="action-btn cancel">Cancel</button></td>
                        {{else}}
                            <td colspan="2"><a href="/reorder-products/{{this._id}}" class="action-btn reorder">Reorder</a></td>
                        {{/if}}
                    </tr>
                    {{/each}}
                </tbody>
            </table>
        </div>
    </div>
</section>

<script>
    function cancelOrderedProducts(cancelOrderId){
        $.ajax({
            url:'/cancel-ordered-products',
            data: { cancelOrderId: cancelOrderId },
            method:'post',
            success:(response)=>{
                if(response.removeOrder){
                    alert(response.message);
                    location.reload(); // Reload the page to see changes
                } else {
                    alert(response.message);
                }
            }
        })
    }
</script>